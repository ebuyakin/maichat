:root {
  /* Base palette (two standard surfaces) */
  --bg: #0c0c0c;           /* primary background (center content) */
  --bg-alt: #242424;       /* secondary surface (top/bottom bars, overlays) lighter for clearer contrast */
  --border: #232323;
  --border-active: #454545;
  --accent: #5fa8ff;
  --text: #e6e6e6;
  --text-dim: #7a7a7a;
  --danger: #f66;
  --focus-ring: #2b4f80; /* darker, thinner focus ring similar to VS Code chat */
  --marked-bg: #103b2c;  /* dark green for marked topic */
  /* VS Code / Copilot Chat style stacks: UI uses system sans; code uses monospace */
  --font-ui: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", system-ui, Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
  --font-mono: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
  --size-base: 13px;
  --topbar-h: 60px;
  --bottombar-h: 96px;
  --gutter: 16px; /* unified left alignment */
  font-family: var(--font-ui);
  font-size: var(--size-base);
  line-height: 1.45;
  color: var(--text);
  background: var(--bg);
}


body, html { margin:0; padding:0; height:100%; overscroll-behavior:none; }
body { min-height:100vh; overflow:hidden; }
#app { height:100vh; width:100vw; position:relative; }

/* Debug HUD */
#hud {
  position:fixed;
  top:50%;
  transform:translateY(-50%);
  right:6px;
  background:#000; /* fully opaque for readability */
  color:#8ab4ff;
  font:11px/1.3 monospace;
  padding:6px 8px;
  border:1px solid #333;
  border-radius:4px;
  width:520px; /* widened for full parameter visibility */
  max-width:60vw; /* responsive cap */
  pointer-events:none;
  white-space:pre; /* keep alignment */
  overflow:auto; /* allow scroll if content wider */
  z-index:1000;
}
 #hud .warn { color:#f6d365; }
 #hud .err { color:#ff6b6b; }

/* Overlay (selectors) */
.overlay-backdrop { position:fixed; inset:0; background:rgba(0,0,0,0.55); display:flex; align-items:flex-start; justify-content:center; padding-top:10vh; z-index:1200; }
.overlay-backdrop.centered { align-items:center; padding-top:0; }
.overlay-panel { background:var(--bg-alt); border:1px solid #222; border-radius:6px; min-width:320px; max-width:80vw; max-height:70vh; display:flex; flex-direction:column; font:var(--size-base)/1.4 var(--font-ui); }
.overlay-panel header { padding:6px 10px; border-bottom:1px solid #222; font-weight:400; letter-spacing:.2px; font-size:var(--size-base); }
.overlay-panel .list { overflow:auto; }
.overlay-panel ul { list-style:none; margin:0; padding:4px 0; }
.overlay-panel li { padding:4px 10px; cursor:pointer; }
.overlay-panel li.active { background:#1e3a5a; color:#fff; }
.overlay-panel li dim { color:#777; }
.overlay-panel footer { border-top:1px solid #222; padding:4px 8px; display:flex; gap:4px; }
.overlay-panel input[type=text] { flex:1; background:#0a0a0a; border:1px solid #333; color:#eee; padding:4px 6px; font:var(--size-base)/1.4 var(--font-ui); }
.settings-panel .settings-body { padding:8px 16px 40px; display:flex; flex-direction:column; gap:0; flex:1; overflow:hidden; }
.settings-panel .settings-tabs { display:flex; gap:6px; padding:8px 12px 6px; border-bottom:1px solid #222; flex-wrap:wrap; }
.settings-panel .settings-tabs .tab-btn { background:#1a1a1a; border:1px solid #2c2c2c; color:var(--text-dim); padding:4px 10px; border-radius:4px; font-size:11px; letter-spacing:.5px; cursor:pointer; }
.settings-panel .settings-tabs .tab-btn.active { color:var(--text); border-color:#3a3a3a; background:#202020; }
.settings-panel .settings-tabs .tab-btn:focus { border-color:var(--accent); }
.settings-panel form { display:flex; flex-direction:column; gap:18px; flex:1; }
.settings-panel .settings-columns { display:grid; grid-template-columns: 1fr 1fr; gap:24px 32px; align-items:start; }
.settings-panel .settings-columns .col { display:flex; flex-direction:column; gap:14px; }
.settings-panel label { display:flex; flex-direction:column; gap:4px; font-size:12px; letter-spacing:.3px; color:var(--text-dim); }
/* Special styling for Part Fraction label to keep hint inline */
.settings-panel label:has(.pf-hint) { flex-direction:column; }
.settings-panel label:has(.pf-hint) > span:first-child { display:flex; align-items:baseline; gap:6px; }
.settings-panel { --settings-fieldset-w:300px; }
.settings-panel input[type=number], .settings-panel select { background:#0a0a0a; border:1px solid #333; color:var(--text); padding:4px 6px; font:var(--size-base)/1.4 var(--font-ui); border-radius:4px; width:100% !important; min-width:0; max-width:100%; box-sizing:border-box; }
.settings-panel [data-tab-section] label { max-width:100%; width:100%; }
.settings-panel fieldset.spacing-fieldset, 
.settings-panel fieldset.layout-fieldset,
.settings-panel fieldset.visibility-fieldset, 
.settings-panel fieldset.scroll-fieldset { 
  border:1px solid #333; 
  padding:14px 18px 18px; 
  border-radius:8px; 
  display:flex; 
  flex-direction:column; 
  gap:12px; 
  width:var(--settings-fieldset-w); 
  max-width:100%; 
  background:rgba(255,255,255,0.01); 
}
.settings-panel fieldset.spacing-fieldset legend { font-size:11px; padding:0 4px; color:var(--text-dim); letter-spacing:.5px; }
.settings-panel { width:640px; max-width:80vw; max-height:70vh; }
/* Compact variant (settings overlay refinement) */
.settings-panel.compact { width:440px; }
@media (max-width:520px){
  .settings-panel.compact { width:92vw; }
}
/* Vertically center only this compact panel without affecting other overlays */
.overlay-backdrop .settings-panel.compact { align-self:center; }
/* Tab hint styling */
.settings-panel .tab-hint { display:none; font-size:11px; color:var(--text-dim); letter-spacing:.4px; margin:6px 2px 0; line-height:1.35; }
/* Slightly dim inline part-fraction hint */
.settings-panel .pf-hint { font-weight:400; }
/* Center each tab's content & constrain fieldset width */
.settings-panel .tab-section { display:flex; flex-direction:column; align-items:center; justify-content:flex-start; min-height:320px; padding-top:6px; }
.settings-panel .tab-section[hidden] { display:none !important; }
.settings-panel .tab-section fieldset { margin:0 auto; }
/* Ensure labels don't stretch panel width; center block */
.settings-panel .tab-section fieldset label { align-items:flex-start; }
.settings-panel .buttons { position:sticky; bottom:0; background:linear-gradient(to top, var(--bg-alt) 65%, rgba(36,36,36,0)); padding-top:10px; }
.settings-panel input[type=number]:focus, .settings-panel select:focus { border-color:var(--accent); }
.settings-panel .buttons { display:flex; justify-content:flex-end; gap:10px; }
.settings-panel button { background:#1a1a1a; border:1px solid #333; color:var(--text); padding:6px 14px; border-radius:4px; cursor:pointer; font:var(--size-base); }
.settings-panel button:hover { border-color:#444; }
.pending-meta { font:11px monospace; color:#6fa8ff; margin-left:8px; align-self:center; }

#topBar { position:fixed; top:0; left:0; right:0; z-index:10; background:var(--bg-alt); padding:8px var(--gutter); display:flex; gap:8px; align-items:center; min-height:var(--topbar-h); border-bottom:1px solid var(--border); }
#topBar input { width:100%; background:var(--bg-alt); border:1px solid var(--border); color:var(--text); padding:6px 0 6px 0; font:var(--size-base)/1.5 var(--font-ui); }
#inputBar { position:fixed; left:0; right:0; bottom:0; z-index:10; background:var(--bg-alt); padding:10px var(--gutter) 14px; border-top:1px solid var(--border); display:flex; }
#inputBar .inputBar-inner { position:relative; width:100%; display:flex; flex-direction:column; gap:6px; }
#historyPane { position:absolute; top:0; bottom:0; left:0; right:0; background:var(--bg); overflow-y:auto; overscroll-behavior:contain; padding:0 var(--gutter) 0; box-shadow:inset 0 1px 0 #121212, inset 0 -1px 0 #121212; }
.zone { border: none; }
#inputBar .row { display:flex; align-items:center; gap:12px; }
#inputBar .row.second { justify-content:space-between; margin-top:2px; }
#inputBar input { flex:1; background:var(--bg-alt); border:none; color:var(--text); padding:10px 0 10px 0; font:var(--size-base)/1.5 var(--font-ui); border-radius:4px; }
#sendBtn { background:var(--bg-alt); color:var(--text); border:1px solid var(--border); padding:6px 20px; cursor:pointer; font-size:var(--size-base); border-radius:4px; font-weight:400; }
#sendBtn:disabled { opacity:.5; cursor:default; }
.mode-label { font-size:11px; color:var(--text-dim); font-weight:400; letter-spacing:.5px; }
/* group for left side of second row */
.input-meta-left { display:flex; gap:10px; align-items:center; }
#pendingModel, #pendingTopic { font-size:12px; color:var(--text); padding:2px 6px; border:1px solid var(--border); border-radius:4px; background:#1c1c1c; }

/* active-zone removed per spec (mode indicated by label only) */

#commandError { color: var(--danger); font-size: 12px; }

.history { display:flex; flex-direction:column; gap:0; }
.pair { padding:2px 0 0; border-bottom:none; text-align:left; }
.part { white-space:pre-wrap; font:var(--size-base)/1.5 var(--font-ui); }
.part.user { background: #0d2233; }
.part.assistant { background: transparent; }
.part.meta { background: transparent; color:var(--text); font-size:var(--size-base); display:flex; align-items:center; padding:2px 0 2px 0; justify-content:space-between; gap:8px; font-weight:400; }
.part.meta .meta-left { display:flex; gap:10px; align-items:center; }
.part.meta .meta-right { display:flex; gap:10px; align-items:center; margin-left:auto; }
/* Active styling now applied to .part.active .part-inner via runtime styles */
.badge { font-size:11px; color:var(--text); font-weight:400; }
.badge.new-reply { background:#1e3a5a; padding:2px 8px; border:1px solid #2c4d73; border-radius:14px; cursor:pointer; }
.badge.new-reply.dim { opacity:.5; }
.badge.topic { max-width:560px; overflow:hidden; text-overflow:ellipsis; }
.badge.timestamp { color:#aaa; font-weight:400; }

/* Global focus handling: remove default outlines (we supply custom states where needed) */
*:focus { outline:none; }
input:focus, button:focus, .overlay-panel input[type=text]:focus { border-color: var(--accent); }

/* Scrollbar minimal */
#historyPane::-webkit-scrollbar { width:8px; }
#historyPane::-webkit-scrollbar-track { background: var(--bg); }
#historyPane::-webkit-scrollbar-thumb { background: var(--border); }
#historyPane::-webkit-scrollbar-thumb:hover { background: var(--border-active); }

/* Reduce selection flash */
::selection { background: #25527a; }

/* Topic Picker (quick) */
.topic-picker-backdrop { position:fixed; inset:0; background:rgba(0,0,0,0.4); display:flex; align-items:flex-start; justify-content:center; padding-top:14vh; z-index:1300; }
.topic-picker { background:var(--bg-alt); border:1px solid #222; border-radius:6px; width:360px; max-height:60vh; display:flex; flex-direction:column; font:var(--size-base)/1.4 var(--font-ui); }
.topic-picker .tp-search { background:#0c0c0c; border:1px solid #333; color:#eee; padding:6px 8px; margin:8px; border-radius:4px; font:var(--size-base)/1.4 var(--font-ui); }
.topic-picker .tp-tree { overflow:auto; padding:4px 0 8px; }
.topic-picker .tp-row { padding:4px 12px; cursor:pointer; display:flex; justify-content:space-between; gap:8px; }
.topic-picker .tp-row.active { background:#1e3a5a; color:#fff; }
.tp-counts { opacity:.55; font-size:11px; }

/* Topic Editor Overlay */
.topic-editor-backdrop { position:fixed; inset:0; background:rgba(0,0,0,0.46); display:flex; align-items:flex-start; justify-content:center; padding-top:10vh; z-index:1400; }
.topic-editor { background:var(--bg-alt); border:1px solid #262626; border-radius:8px; width:560px; max-height:70vh; display:flex; flex-direction:column; font:var(--size-base)/1.45 var(--font-ui); box-shadow:0 4px 24px rgba(0,0,0,0.5); }
.topic-editor .te-header { padding:8px 12px; font-weight:400; border-bottom:1px solid #222; letter-spacing:.2px; color:var(--text); font-size:var(--size-base); background:var(--bg-alt); }
.topic-editor .te-search { background:#0c0c0c; border:1px solid #333; color:#eee; padding:6px 10px; margin:8px 10px 4px; border-radius:4px; font:13px var(--font-ui); }
.topic-editor .te-tree { flex:1; overflow:auto; padding:6px 0 6px; }
.topic-editor .te-row { padding:3px 12px 3px 12px; cursor:default; white-space:nowrap; font:var(--size-base)/1.45 var(--font-ui); display:flex; align-items:center; gap:6px; font-weight:400; }
.topic-editor .te-row.active { background:#1e3a5a; color:#fff; }
.topic-editor .te-row.marked { background:var(--marked-bg); color:#d2f2e0; }
.topic-editor .te-row.active.marked { background:#195a82; /* keep active emphasis over marked */ }
.topic-editor .te-row.creating { background:#142636; }
.topic-editor .te-row input.te-edit { background:#060606; border:1px solid #444; color:#eee; padding:2px 4px; font:var(--size-base)/1.3 var(--font-ui); border-radius:3px; min-width:220px; }
.topic-editor .te-row input.te-edit:focus { border-color:var(--accent); }
.topic-editor .te-counts { margin-left:auto; opacity:.5; font-size:11px; }
.topic-editor .te-warning { min-height:20px; padding:4px 10px 6px; font:11px/1.4 var(--font-ui); color:#f88; border-top:1px solid #222; opacity:0; transition:opacity .2s; letter-spacing:.3px; }
.topic-editor .te-tree:focus { outline:none; }
.topic-editor .te-warning.visible { opacity:1; }


