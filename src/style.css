:root {
  /* Base palette (two standard surfaces) */
  --bg: #0c0c0c;           /* primary background (center content) */
  --bg-alt: #242424;       /* secondary surface (top/bottom bars, overlays) lighter for clearer contrast */
  --border: #232323;
  --border-active: #454545;
  --accent: #5fa8ff;
  --text: #e6e6e6;
  --text-dim: #7a7a7a;
  --danger: #f66;
  --focus-ring: #007ACC; /* VS Code focus blue */
  /* Unified control surfaces */
  --input-bg: #0a0a0a;
  --btn-bg: #1a1a1a;
  --btn-border: #333;
  --btn-bg-hover: #222;
  --marked-bg: #103b2c;  /* dark green for marked topic */
  /* VS Code / Copilot Chat style stacks: UI uses system sans; code uses monospace */
  --font-ui: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", system-ui, Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
  --font-mono: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
  --size-base: 13px;
  --topbar-h: 60px;
  --bottombar-h: 96px;
  --gutter: 16px; /* unified left alignment */
  font-family: var(--font-ui);
  font-size: var(--size-base);
  line-height: 1.45;
  color: var(--text);
  background: var(--bg);
}


body, html { margin:0; padding:0; height:100%; overscroll-behavior:none; }
body { min-height:100vh; overflow:hidden; }
#app { height:100vh; width:100vw; position:relative; }

/* Debug HUD */
#hud {
  position:fixed;
  top:50%;
  transform:translateY(-50%);
  right:6px;
  background:#000; /* fully opaque for readability */
  color:#8ab4ff;
  font:11px/1.3 monospace;
  padding:6px 8px;
  border:1px solid #333;
  border-radius:4px;
  width:520px; /* default width */
  max-width:70vw; /* responsive cap */
  min-width:260px;
  max-height:80vh;
  min-height:120px;
  resize:both; /* user can drag to resize */
  pointer-events:auto; /* allow mouse to grab resize handle */
  user-select:text;
  white-space:pre; /* keep alignment */
  overflow:auto; /* allow scroll if content larger */
  z-index:1000;
}
 #hud .warn { color:#f6d365; }
 #hud .err { color:#ff6b6b; }

/* Overlay (selectors) */
.overlay-backdrop { position:fixed; inset:0; background:rgba(0,0,0,0.55); display:flex; align-items:flex-start; justify-content:center; padding-top:10vh; z-index:1200; }
.overlay-backdrop.centered { align-items:center; padding-top:0; }
.overlay-panel { background:var(--bg-alt); border:1px solid #222; border-radius:6px; min-width:320px; max-width:80vw; max-height:70vh; display:flex; flex-direction:column; font:var(--size-base)/1.4 var(--font-ui); padding-top:6px; }
.overlay-panel header { padding:10px 12px 6px; border-bottom:1px solid #222; font-weight:400; letter-spacing:.2px; font-size:var(--size-base); }
.overlay-panel .list { overflow:auto; }
.overlay-panel ul { list-style:none; margin:0; padding:4px 0; }
.overlay-panel li { padding:4px 10px; cursor:pointer; }
.overlay-panel li.active { background:#1e3a5a; color:#fff; }
.overlay-panel li dim { color:#777; }
.overlay-panel.model-editor { 
  max-width:900px; 
  --me-scrollbar-w: 11px; 
  --me-scrollbar-track-border: 1px; 
  --me-list-right-margin: 6px; 
  --me-right-gutter: calc(14px + var(--me-scrollbar-w) + var(--me-scrollbar-track-border) + var(--me-list-right-margin));
  --me-grid-columns: 80px 1fr 110px 100px 90px 90px;
}
/* Right gutter to align non-scrolling blocks with the scrollable list's scrollbar */
.overlay-panel.model-editor .me-head,
.overlay-panel.model-editor .me-add-controls,
.overlay-panel.model-editor .me-hint,
.overlay-panel.model-editor .me-controls { padding-right: var(--me-right-gutter); }
.overlay-panel.model-editor .me-table { display:flex; flex-direction:column; }
.overlay-panel.model-editor .me-head { display:grid; grid-template-columns: var(--me-grid-columns); align-items:center; gap:8px; padding:6px 14px; font:11px/1.2 var(--font-ui); color:#9aa; letter-spacing:.3px; margin-bottom:3px; border-bottom:none; }
.overlay-panel.model-editor .me-head,
.overlay-panel.model-editor .me-add-controls,
.overlay-panel.model-editor .me-hint,
.overlay-panel.model-editor .me-controls { padding-right: var(--me-right-gutter); }
.overlay-panel.model-editor ul { padding:0; }
/* Always-visible, slightly wider scrollbar */
.overlay-panel.model-editor .list { position:relative; max-height: calc(10 * 30px + 8px); overflow-y: scroll; overflow-x: hidden; margin-right: var(--me-list-right-margin); }
.overlay-panel.model-editor .list::-webkit-scrollbar { width: var(--me-scrollbar-w); }
.overlay-panel.model-editor .list::-webkit-scrollbar-track { background: #0b0b0b; border-left: var(--me-scrollbar-track-border) solid #202020; }
.overlay-panel.model-editor .list::-webkit-scrollbar-thumb { background: #2a2a2a; border-radius: 6px; }
.overlay-panel.model-editor .list::-webkit-scrollbar-thumb:hover { background: #3a3a3a; }
.overlay-panel.model-editor li { display:grid; grid-template-columns: var(--me-grid-columns); align-items:center; gap:8px; font:var(--size-base)/1.35 var(--font-ui); padding:3px 14px; min-height:27px; }
.overlay-panel.model-editor li.me-add { opacity:.9; }
.overlay-panel.model-editor .me-actions { display:flex; align-items:center; gap:8px; }
.overlay-panel.model-editor .me-add .me-id-input, .overlay-panel.model-editor .me-new .me-id-input { background: transparent; border: 1px solid #333; color: var(--text); padding: 4px 6px; font: var(--size-base)/1.4 var(--font-ui); border-radius: 4px; width: 100%; box-sizing: border-box; }
/* Pending new model row (inline) */
.overlay-panel.model-editor .me-name-input,
.overlay-panel.model-editor .me-col input.me-num {
  background: transparent;
  border: 1px solid #333;
  color: var(--text);
  padding: 4px 6px;
  font: var(--size-base)/1.4 var(--font-ui);
  border-radius: 4px;
  width: 100%;
  box-sizing: border-box;
}
/* Separator block between table and new model */
.overlay-panel.model-editor .me-sep { border-top:1px solid #222; margin: 4px 14px 8px; height:0; }

/* Remove gradient scroll indicators */
.overlay-panel.model-editor .list:before,
.overlay-panel.model-editor .list:after { display:none !important; }
.overlay-panel.model-editor li.me-row .me-col-toggle { text-align:center; font-size:14px; cursor:pointer; color:#6fa8ff; }
.overlay-panel.model-editor li.me-row .me-col-toggle.off { color:#555; }
.overlay-panel.model-editor li.me-row .me-col-name { font-weight:400; letter-spacing:.3px; }
.overlay-panel.model-editor li.me-row .me-col-name .me-active { background:#123; color:#8ab4ff; font-size:11px; padding:2px 8px; border:1px solid #1e3a5a; border-radius:12px; margin-left:8px; letter-spacing:.4px; }
/* Non-intrusive outline for selected column in Model Editor (keyboard nav); no layout change */
.overlay-panel.model-editor .me-col.me-col-selected { outline: 1px solid #3b82f6; outline-offset: 2px; border-radius: 3px; }
.overlay-panel.model-editor .me-col-cw input,
.overlay-panel.model-editor .me-col-tpm input,
.overlay-panel.model-editor .me-col-rpm input,
.overlay-panel.model-editor .me-col-tpd input { 
  background: transparent; 
  border: 1px solid #333; 
  color: var(--text); 
  padding: 4px 6px; 
  font: var(--size-base)/1.4 var(--font-ui); 
  border-radius: 4px; 
  width: 100%; 
  box-sizing: border-box; 
}
.overlay-panel.model-editor input.me-num {
  appearance: textfield;
  -moz-appearance: textfield;
}
.overlay-panel.model-editor input.me-num::-webkit-outer-spin-button,
.overlay-panel.model-editor input.me-num::-webkit-inner-spin-button {
  -webkit-appearance: none;
  margin: 0;
}
.overlay-panel.model-editor .me-col-cw input:focus,
.overlay-panel.model-editor .me-col-tpm input:focus,
.overlay-panel.model-editor .me-col-rpm input:focus,
.overlay-panel.model-editor .me-col-tpd input:focus,
.overlay-panel.model-editor input.me-name-input:focus { border-color: #333; box-shadow:none; }

/* Daily Stats overlay active row highlight */
.daily-stats-panel .stats-table tr.active td { background:#162234; }
.overlay-panel.model-editor footer { justify-content:flex-start; align-items:flex-start; flex-direction:column; gap:6px; }
.overlay-panel.model-editor .me-hint { font-size:11px; color:#888; padding:10px 8px 0; padding-left: 6px; }
.overlay-panel.model-editor .ghost-passive { opacity:.45; pointer-events:none; }
.overlay-panel.model-editor .me-controls { width:100%; display:flex; justify-content:space-between; align-items:center; padding:5px 8px; padding-left: 3px; }
.overlay-panel.model-editor .me-controls-left { display:flex; gap:8px; }
.overlay-panel.model-editor .me-controls-right { margin-left:auto; display:flex; gap:8px; }
.model-selector-panel { min-width:380px; }
.model-selector-panel .ms-body { padding:10px 14px 14px; display:flex; flex-direction:column; gap:8px; }
.model-selector-panel .filter-row { font:var(--size-base)/1.3 var(--font-ui); color:var(--text-dim); letter-spacing:.3px; min-height:18px; }
.model-selector-panel .filter-row .filter-value { color:var(--text); }
.model-selector-panel .model-list { margin:0; padding:2px 0; overflow:auto; flex:1; }
.model-selector-panel .model-list .model-item { padding:4px 12px; font:var(--size-base)/1.35 var(--font-ui); letter-spacing:.2px; }
.model-selector-panel .model-list .model-item.active { background:#1e3a5a; color:#fff; }
.model-selector-panel .ms-hint { font-size:11px; color:#888; letter-spacing:.4px; text-align:center; margin-top:6px; line-height:1.35; }
.overlay-panel footer { border-top:1px solid #222; padding:8px 12px; display:flex; gap:4px; }
.overlay-panel input[type=text] { flex:1; background:#0a0a0a; border:1px solid #333; color:#eee; padding:4px 6px; font:var(--size-base)/1.4 var(--font-ui); }
.settings-panel .settings-body { padding:8px 16px 40px; display:flex; flex-direction:column; gap:0; flex:1; overflow:hidden; }
.settings-panel .settings-tabs { display:flex; gap:6px; padding:8px 12px 6px; border-bottom:1px solid #222; flex-wrap:wrap; }
.settings-panel .settings-tabs .tab-btn { background:#1a1a1a; border:1px solid #2c2c2c; color:var(--text-dim); padding:4px 10px; border-radius:4px; font-size:11px; letter-spacing:.5px; cursor:pointer; }
.settings-panel .settings-tabs .tab-btn.active { color:var(--text); border-color:#3a3a3a; background:#202020; }
.settings-panel .settings-tabs .tab-btn:focus { border-color:var(--accent); }
.settings-panel form { display:flex; flex-direction:column; gap:18px; flex:1; }
.settings-panel .settings-columns { display:grid; grid-template-columns: 1fr 1fr; gap:24px 32px; align-items:start; }
.settings-panel .settings-columns .col { display:flex; flex-direction:column; gap:14px; }
.settings-panel label { display:flex; flex-direction:column; gap:4px; font-size:12px; letter-spacing:.3px; color:var(--text-dim); }
/* Special styling for Part Fraction label to keep hint inline */
.settings-panel label:has(.pf-hint) { flex-direction:column; }
.settings-panel label:has(.pf-hint) > span:first-child { display:flex; align-items:baseline; gap:6px; }
.settings-panel { --settings-fieldset-w:300px; }
.settings-panel input[type=number], .settings-panel select { background:var(--input-bg); border:1px solid #333; color:var(--text); padding:4px 6px; font:var(--size-base)/1.4 var(--font-ui); border-radius:4px; width:100% !important; min-width:0; max-width:100%; box-sizing:border-box; }
.settings-panel [data-tab-section] label { max-width:100%; width:100%; }
.settings-panel fieldset.spacing-fieldset, 
.settings-panel fieldset.layout-fieldset,
.settings-panel fieldset.visibility-fieldset, 
.settings-panel fieldset.scroll-fieldset { 
  border:1px solid #333; 
  padding:14px 18px 18px; 
  border-radius:8px; 
  display:flex; 
  flex-direction:column; 
  gap:12px; 
  width:var(--settings-fieldset-w); 
  max-width:100%; 
  background:rgba(255,255,255,0.01); 
}
.settings-panel fieldset.spacing-fieldset legend { font-size:11px; padding:0 4px; color:var(--text-dim); letter-spacing:.5px; }
.settings-panel { width:640px; max-width:80vw; max-height:70vh; min-height:520px; }
/* Compact variant (settings overlay refinement) */
.settings-panel.compact { width:440px; }
@media (max-width:520px){
  .settings-panel.compact { width:92vw; }
}
/* Vertically center only this compact panel without affecting other overlays */
.overlay-backdrop .settings-panel.compact { align-self:center; }
/* Tab hint styling */
.settings-panel .tab-hint { display:none; font-size:11px; color:var(--text-dim); letter-spacing:.4px; margin:6px 2px 0; line-height:1.35; width:var(--settings-fieldset-w); text-align:center; }
.settings-panel .tab-hint[data-tab-hint="layout"] { display:block; }
/* Slightly dim inline part-fraction hint */
.settings-panel .pf-hint { font-weight:400; }
/* Center each tab's content & constrain fieldset width */
.settings-panel .tab-section { display:flex; flex-direction:column; align-items:center; justify-content:flex-start; min-height:320px; padding-top:6px; }
.settings-panel .tab-section[hidden] { display:none !important; }
.settings-panel .tab-section fieldset { margin:0 auto; }
/* Ensure labels don't stretch panel width; center block */
.settings-panel .tab-section fieldset label { align-items:flex-start; }
.settings-panel .buttons { position:sticky; bottom:0; background:linear-gradient(to top, var(--bg-alt) 65%, rgba(36,36,36,0)); padding-top:40px; }
.settings-panel input[type=number]:focus, .settings-panel select:focus { border-color:var(--accent); }
.settings-panel .buttons { display:flex; justify-content:flex-end; gap:10px; }
.settings-panel button { background:var(--btn-bg); border:1px solid var(--btn-border); color:var(--text); padding:6px 14px; border-radius:4px; cursor:pointer; font:var(--size-base); transition:background .15s, border-color .15s; }
.settings-panel button:hover, .settings-panel button:focus { background:var(--btn-bg-hover); border-color:#444; }
/* Global reusable button / input classes */
.btn { background:var(--btn-bg); border:1px solid var(--btn-border); color:var(--text); padding:7px 16px; border-radius:4px; cursor:pointer; font:var(--size-base); font-family:var(--font-ui); letter-spacing:.2px; transition:background .15s, border-color .15s; }
.btn:hover, .btn:focus { background:var(--btn-bg-hover); border-color:#444; }
.btn-sm { padding:5px 12px; font-size:12px; }
.btn-danger { color:#f99; border-color:#553; }
.btn-danger:hover, .btn-danger:focus { border-color:#744; color:#faa; }
.std-input { background:var(--input-bg); border:1px solid #333; color:var(--text); padding:6px 8px; font:var(--size-base)/1.4 var(--font-ui); border-radius:4px; width:100%; box-sizing:border-box; }
.std-input:focus { border-color:var(--accent); }
.api-keys-panel { width:420px; max-width:90vw; }
.api-keys-panel .keys-body label span { font-weight:500; letter-spacing:.3px; }
.api-keys-panel input[type=password] { background:var(--input-bg); border:1px solid #333; color:var(--text); padding:6px 8px; font:var(--size-base)/1.4 var(--font-ui); border-radius:4px; }
.api-keys-panel input[type=password]:focus { border-color:var(--accent); }
.api-keys-panel .keys-body button { background:var(--btn-bg); border:1px solid var(--btn-border); }
.api-keys-panel .keys-body button:hover, .api-keys-panel .keys-body button:focus { background:var(--btn-bg-hover); border-color:#444; }
.api-keys-panel .keys-body { padding:14px 18px 8px; display:flex; flex-direction:column; gap:14px; }
.api-keys-panel .keys-note { margin:0; font-size:12px; line-height:1.5; color:#bbb; }
.api-keys-panel .key-field { display:flex; flex-direction:column; gap:4px; font-size:12px; color:#999; }
.api-keys-panel .keys-buttons { display:flex; gap:8px; justify-content:flex-end; margin-top:8px; }
.api-keys-panel .keys-footnote { font-size:11px; opacity:.55; }
.pending-meta { font:11px monospace; color:#6fa8ff; margin-left:8px; align-self:center; }

#topBar { position:fixed; top:0; left:0; right:0; z-index:10; background:var(--bg-alt); padding:8px var(--gutter); display:flex; gap:8px; align-items:center; min-height:var(--topbar-h); border-bottom:1px solid var(--border); }
#topBar input { width:100%; background:var(--bg-alt); border:1px solid var(--border); color:var(--text); padding:6px 0 6px 0; font:var(--size-base)/1.5 var(--font-ui); }
#statusRight { margin-left:auto; display:flex; align-items:center; gap:10px; position:relative; min-width:0; }
/* Command zone element normalization */
#statusRight > * { box-sizing:border-box; }
#statusRight .mc, #statusRight .menu-btn { flex:0 0 auto; }
#messageCount.mc { font:11px var(--font-mono); background:transparent; padding:6px 10px; border:1px solid #2a2a2a; border-radius:4px; color:#9ab; letter-spacing:.5px; display:flex; align-items:center; height:34px; }
.menu-btn { background:transparent; border:1px solid #2a2a2a; color:#ddd; padding:6px 10px; cursor:pointer; border-radius:4px; font-size:15px; line-height:1; display:flex; align-items:center; justify-content:center; height:34px; }
.menu-btn:focus, .menu-btn:hover { border-color:#3a3a3a; color:#fff; }
.app-menu { position:absolute; top:100%; right:0; background:var(--bg-alt); border:1px solid #222; box-shadow:0 4px 18px rgba(0,0,0,0.5); padding:4px 0; border-radius:6px; min-width:200px; z-index:900; }
.app-menu ul { list-style:none; margin:0; padding:0; }
.app-menu li { display:flex; justify-content:space-between; gap:12px; padding:6px 14px; cursor:pointer; font:12px/1.4 var(--font-ui); color:var(--text); }
.app-menu li:hover, .app-menu li.active { background:#1e3a5a; }
.app-menu li .hint { color:#788; font-size:11px; letter-spacing:.5px; }
#inputBar { position:fixed; left:0; right:0; bottom:0; z-index:10; background:var(--bg-alt); padding:10px var(--gutter) 14px; border-top:1px solid var(--border); display:flex; }
#inputBar .inputBar-inner { position:relative; width:100%; display:flex; flex-direction:column; gap:6px; }
#historyPane { position:absolute; top:0; bottom:0; left:0; right:0; background:var(--bg); overflow-y:auto; overscroll-behavior:contain; padding:0 var(--gutter) 0; box-shadow:inset 0 1px 0 #121212, inset 0 -1px 0 #121212; }
.zone { border: none; }
#inputBar .row { display:flex; align-items:center; gap:12px; }
#inputBar .row.second { justify-content:space-between; margin-top:2px; }
#inputBar input { flex:1; background:var(--bg-alt); border:none; color:var(--text); padding:10px 0 10px 0; font:var(--size-base)/1.5 var(--font-ui); border-radius:4px; }
#sendBtn { background:var(--bg-alt); color:var(--text); border:1px solid #2a2a2a; padding:6px 20px; cursor:pointer; font-size:var(--size-base); border-radius:4px; font-weight:400; min-width:134px; display:inline-flex; justify-content:flex-end; align-items:center; font-family:var(--font-ui); letter-spacing:.3px; position:relative; }
#sendBtn:disabled { opacity:.5; cursor:default; }
/* Keep 'AI is thinking' legible (we set text content while pending but keep normal color) */
#sendBtn.pending { opacity:1 !important; justify-content:flex-start; }
#sendBtn .lbl { display:inline-block; }
#sendBtn .dots { display:inline-flex; width:18px; margin-left:6px; justify-content:flex-start; }
#sendBtn .dots span { width:4px; text-align:center; opacity:0; transition:opacity .25s linear; }
.mode-label { font-size:11px; color:var(--text-dim); font-weight:400; letter-spacing:.5px; width:70px; display:inline-flex; justify-content:flex-start; align-items:center; background:transparent; height:34px; }
/* group for left side of second row */
.input-meta-left { display:flex; gap:10px; align-items:center; }
#pendingModel, #pendingTopic { font-size:12px; color:var(--text); padding:4px 8px; border:1px solid #2a2a2a; border-radius:4px; background:transparent; display:inline-flex; align-items:center; height:34px; box-sizing:border-box; }
#pendingModel { width:140px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; justify-content:flex-start; }
#pendingTopic { max-width:340px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }

/* active-zone removed per spec (mode indicated by label only) */

#commandError { color: var(--danger); font-size: 12px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; max-width:50vw; flex:1 1 auto; }

.history { display:flex; flex-direction:column; gap:0; }
.pair { padding:2px 0 0; border-bottom:none; text-align:left; }
.part { white-space:pre-wrap; font:var(--size-base)/1.5 var(--font-ui); }
.part.user { background: #0d2233; }
.part.assistant { background: transparent; }
.part.meta { background: transparent; color:var(--text); font-size:var(--size-base); display:flex; align-items:center; padding:2px 0 2px 0; justify-content:space-between; gap:8px; font-weight:400; }
.part.meta .meta-left { display:flex; gap:10px; align-items:center; }
.part.meta .meta-right { display:flex; gap:10px; align-items:center; margin-left:auto; }
/* Active styling now applied to .part.active .part-inner via runtime styles */
.badge { font-size:11px; color:var(--text); font-weight:400; }
.badge.new-reply { background:#1e3a5a; padding:2px 8px; border:1px solid #2c4d73; border-radius:14px; cursor:pointer; }
.badge.new-reply.dim { opacity:.5; }
.badge.topic { max-width:560px; overflow:hidden; text-overflow:ellipsis; }
.badge.timestamp { color:#aaa; font-weight:400; }
/* Minimal badges (terminal style) */
.badge.include { background:transparent; border:none; text-transform:none; font-size:11px; letter-spacing:.3px; padding:0 2px; }
.badge.flag { display:inline-block; width:10px; height:10px; position:relative; top:1px; }
.badge.flag[data-flag='b'] { background:#1f4d99; border:1px solid #1f4d99; }
.badge.flag[data-flag='g'] { background:transparent; border:1px solid #666; border-radius:50%; }
.badge.offctx { background:transparent; border:none; color:#ff9fb2; text-transform:none; font-size:11px; letter-spacing:.3px; }
.badge.model { background:transparent; border:none; color:var(--text-dim); }
.badge.state { background:transparent; border:none; color:var(--text-dim); min-width:18px; text-align:center; border-radius:0; padding:0 2px; }
.badge.state[data-state=sending] { animation:pulse 1.2s ease-in-out infinite; }
.badge.state.error { color:var(--text-dim); }
@keyframes pulse { 0%{opacity:.3;} 50%{opacity:1;} 100%{opacity:.3;} }
.err-actions { display:inline-flex; gap:6px; }
/* Align error action buttons' font-size with badges (11px) in the meta row */
.part.meta .err-actions .btn-ghost { font-size:11px; padding:3px 8px; line-height:1.2; }

/* Subtle ghost button for inline actions */
.btn-ghost { 
  background: transparent; 
  border: 1px solid #2a2a2a; 
  color: var(--text-dim); 
  padding: 2px 8px; 
  border-radius: 4px; 
  cursor: pointer; 
  font: inherit; 
  letter-spacing: .2px; 
}
.btn-ghost:hover, .btn-ghost:focus { 
  border-color: #3a3a3a; 
  color: var(--text); 
}
.btn-ghost.btn-sm { padding: 5px 12px; font-size: 12px; }

/* Global focus handling: remove default outlines (we supply custom states where needed) */
*:focus { outline:none; }
input:focus, button:focus, .overlay-panel input[type=text]:focus { border-color: var(--accent); }

/* Scrollbar minimal */
#historyPane::-webkit-scrollbar { width:8px; }
#historyPane::-webkit-scrollbar-track { background: var(--bg); }
#historyPane::-webkit-scrollbar-thumb { background: var(--border); }
#historyPane::-webkit-scrollbar-thumb:hover { background: var(--border-active); }

/* Reduce selection flash */
::selection { background: #25527a; }

/* Topic Picker (quick) */
.topic-picker-backdrop { position:fixed; inset:0; background:rgba(0,0,0,0.4); display:flex; align-items:flex-start; justify-content:center; padding-top:14vh; z-index:1300; }
.topic-picker { background:var(--bg-alt); border:1px solid #222; border-radius:6px; width:360px; max-height:60vh; display:flex; flex-direction:column; font:var(--size-base)/1.4 var(--font-ui); }
.topic-picker .tp-search { background:#0c0c0c; border:1px solid #333; color:#eee; padding:6px 8px; margin:8px; border-radius:4px; font:var(--size-base)/1.4 var(--font-ui); }
.topic-picker .tp-tree { overflow:auto; padding:4px 0 8px; }
.topic-picker .tp-row { padding:4px 12px; cursor:pointer; display:flex; justify-content:space-between; gap:8px; }
.topic-picker .tp-row.active { background:#1e3a5a; color:#fff; }
.tp-counts { opacity:.55; font-size:11px; }

/* Topic Editor Overlay */
.topic-editor-backdrop { position:fixed; inset:0; background:rgba(0,0,0,0.46); display:flex; align-items:flex-start; justify-content:center; padding-top:10vh; z-index:1400; }
.topic-editor { background:var(--bg-alt); border:1px solid #262626; border-radius:8px; width:560px; max-height:70vh; display:flex; flex-direction:column; font:var(--size-base)/1.45 var(--font-ui); box-shadow:0 4px 24px rgba(0,0,0,0.5); }
.topic-editor .te-header { padding:8px 12px; font-weight:400; border-bottom:1px solid #222; letter-spacing:.2px; color:var(--text); font-size:var(--size-base); background:var(--bg-alt); }
.topic-editor .te-search { background:#0c0c0c; border:1px solid #333; color:#eee; padding:6px 10px; margin:8px 10px 4px; border-radius:4px; font:13px var(--font-ui); }
.topic-editor .te-tree { flex:1; overflow:auto; padding:6px 0 6px; }
.topic-editor .te-row { padding:3px 12px 3px 12px; cursor:default; white-space:nowrap; font:var(--size-base)/1.45 var(--font-ui); display:flex; align-items:center; gap:6px; font-weight:400; }
.topic-editor .te-row.active { background:#1e3a5a; color:#fff; }
.topic-editor .te-row.marked { background:var(--marked-bg); color:#d2f2e0; }
.topic-editor .te-row.active.marked { background:#195a82; /* keep active emphasis over marked */ }
.topic-editor .te-row.creating { background:#142636; }
.topic-editor .te-row input.te-edit { background:#060606; border:1px solid #444; color:#eee; padding:2px 4px; font:var(--size-base)/1.3 var(--font-ui); border-radius:3px; min-width:220px; }
.topic-editor .te-row input.te-edit:focus { border-color:var(--accent); }
.topic-editor .te-counts { margin-left:auto; opacity:.5; font-size:11px; }
.topic-editor .te-warning { min-height:20px; padding:4px 10px 6px; font:11px/1.4 var(--font-ui); color:#f88; border-top:1px solid #222; opacity:0; transition:opacity .2s; letter-spacing:.3px; }
.topic-editor .te-tree:focus { outline:none; }
.topic-editor .te-warning.visible { opacity:1; }

/* Out-of-context visual marking */
/* Adjusted (2025-08-31): reduced dimming strength for readability while keeping distinction */
.part.ooc .part-inner { opacity:0.55; }
.part.ooc.meta .part-inner { opacity:0.7; }


/* Help Overlay */
.help-panel { width:1320px; max-width:98vw; box-sizing:border-box; overflow:hidden; }
.help-panel .help-body { padding:14px 18px 12px; display:flex; flex-direction:column; gap:12px; font:var(--size-base)/1.45 var(--font-ui); color:var(--text); overflow:auto; }
/* Responsive font scaling for Help overlay */
.help-panel .help-body { font-size: clamp(12px, 1.5vw, var(--size-base)); }
.help-panel .help-body section { font-weight:400; letter-spacing:.2px; }
.help-panel .help-body strong { font-weight:500; color:var(--text); }

/* Help overlay: 4-column aligned layout */
.help-grid {
  display: grid;
  grid-template-columns: 1.15fr 1.05fr 1.35fr 1.45fr; /* ~10px more reduction for Global/Input */
  gap: 16px 20px;
  align-items: start;
}

.help-col {
  display: grid;
  grid-template-columns: auto 1fr;
  column-gap: 16px; /* increased gap by 10px */
  row-gap: 8px; /* uniform row spacing across columns */
  align-content: start; /* prevent stretch-based distribution */
  border: 1px solid var(--border, #333); /* subtle column border, dark */
  border-radius: 6px;
  padding: 8px;
  background: transparent;
}

.help-title {
  grid-column: 1 / -1;
  font-weight: 400; /* no bold */
  color: var(--text-dim); /* different color only */
  margin-bottom: 4px;
}

.help-subtitle { grid-column: 1 / -1; margin: 0; font-size: inherit; color: var(--text-dim); }

.help-k {
  /* same font type/size as the rest */
  color: var(--text); /* white-ish */
  background: transparent; /* no separate background */
  border: none; /* no box */
  border-radius: 0;
  padding: 0; /* tight, terminal-like */
  line-height: 1.45;
  white-space: nowrap;
}

.help-d { color: var(--text-dim); }

@media (max-width: 1040px) {
  /* Prefer font and gap scaling to keep 4 columns around 1024px */
  .help-panel { width:96vw; }
  .help-panel .help-body { font-size: clamp(11px, 1.2vw, var(--size-base)); }
  .help-grid { gap: 14px 14px; }
  .help-col { column-gap: 14px; }
}

@media (max-width: 1000px) {
  /* Below ~1000px, switch to 2 columns for readability */
  .help-grid { grid-template-columns: repeat(2, 1fr); }
}

@media (max-width: 720px) {
  .help-grid { grid-template-columns: 1fr; }
}

/* If viewport height is tight, slightly reduce font-size to keep content visible */
@media (max-height: 820px) {
  .help-panel .help-body { font-size: clamp(11px, 1.3vh, var(--size-base)); }
}
.help-panel .help-hint { font-size:11px; opacity:.6; letter-spacing:.4px; }
.help-panel .help-buttons { display:flex; justify-content:flex-end; gap:8px; margin-top:4px; }


