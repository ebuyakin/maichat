.history { display:flex; flex-direction:column; gap:0; }
/* Assistant body sits directly below header without extra vertical whitespace */
.part.assistant .assistant-body{ display:block; margin:0; padding-top:6px; }
.part.assistant .part-inner{ min-height: initial; }
.badge { font-size:11px; color:var(--text); font-weight:400; }
.badge.new-reply { background:#1e3a5a; padding:2px 8px; border:1px solid #2c4d73; border-radius:14px; cursor:pointer; }
.badge.new-reply.dim { opacity:.5; }
.badge.topic { max-width:560px; overflow:hidden; text-overflow:ellipsis; }
.badge.timestamp { color:#aaa; font-weight:400; }
.badge.include { background:transparent; border:none; text-transform:none; font-size:11px; letter-spacing:.3px; padding:0 2px; }
.badge.flag { display:inline-block; width:10px; height:10px; position:relative; top:1px; }
.badge.flag[data-flag='b'] { background:#1f4d99; border:1px solid #1f4d99; }
.badge.flag[data-flag='g'] { background:transparent; border:1px solid #666; border-radius:50%; }
.badge.offctx { background:transparent; border:none; color:#ff9fb2; text-transform:none; font-size:11px; letter-spacing:.3px; }
.badge.model { background:transparent; border:none; color:var(--text-dim); }
.badge.state { background:transparent; border:none; color:var(--text-dim); min-width:18px; text-align:center; border-radius:0; padding:0 2px; }
.badge.state[data-state=sending] { animation:pulse 1.2s ease-in-out infinite; }
.badge.state.error { color:var(--text-dim); }
@keyframes pulse { 0%{opacity:.3;} 50%{opacity:1;} 100%{opacity:.3;} }
.err-actions { display:inline-flex; gap:6px; }

/* Legacy gap elements removed; separation via margins below */

/* Message-based layout: symmetric gaps and L2 gutters */
#history .message{ display:block; margin-top: var(--message-gap); margin-bottom: var(--message-gap); }
#history .message.user{ background:#0d2233; padding: 8px var(--msg-gutter-r) 8px var(--msg-gutter-l); border-radius:3px; white-space:pre-wrap; }
#history .message.assistant{ background:transparent; padding: 8px var(--msg-gutter-r) 8px var(--msg-gutter-l); }
#history .message.assistant .assistant-meta{ display:flex; align-items:center; gap:12px; white-space:nowrap; padding: 0; margin-bottom:5px; }
#history .message.assistant .assistant-meta .meta-left{ display:flex; gap:10px; align-items:center; }
#history .message.assistant .assistant-meta .meta-right{ display:flex; gap:10px; align-items:center; margin-left:auto; }
#history .message.assistant .assistant-body{ display:block; margin:0; padding-top:6px; white-space:pre-wrap; }
#history .message.active{ outline:1px solid var(--focus-ring); outline-offset:-1px; box-shadow: 0 0 0 1px var(--focus-ring) inset; }

/* Assistant meta: unified typography (UI font, smaller size, grey color) */
#history .message.assistant .assistant-meta{
  font: 11px/1.45 var(--font-ui);
  color: var(--text-dim);
}
#history .message.assistant .assistant-meta .badge{ font: inherit; color: inherit; }
#history .message.assistant .assistant-meta .badge.topic{ color: inherit; }
#history .message.assistant .assistant-meta .badge.model{ color: inherit; }
#history .message.assistant .assistant-meta .badge.state{ color: inherit; }
#history .message.assistant .assistant-meta .badge.offctx{ color: inherit; }
#history .message.assistant .assistant-meta .badge.include{ color: inherit; }

/* History pane: top/bottom padding controlled in layout; ensure zero here */
#historyPane{ padding-top: 0; padding-bottom: 0; box-shadow:inset 0 1px 0 #121212, inset 0 -1px 0 #121212; }

/* Scrollbar minimal */
#historyPane::-webkit-scrollbar { width:8px; }
#historyPane::-webkit-scrollbar-track { background: var(--bg); }
#historyPane::-webkit-scrollbar-thumb { background: var(--border); }
#historyPane::-webkit-scrollbar-thumb:hover { background: var(--border-active); }

/* Code placeholders styling */
.code-placeholder {
  color: #85db87;
  white-space: normal !important;
}
.eq-placeholder {
  color: #5dd6d3;
  white-space: normal !important;
}
.eq-inline {
  color: #5dd6d3;
  font-style: normal;
  white-space: normal !important;
}