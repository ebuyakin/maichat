## Message deletion analysis and problems

1. We implemented delete message colon command and then we discovered that there needs some coordination of deleting message pairs with deletion of the images (in order to avoid orphan images in the image object store). 
2. The current implementation assumes (it has never been used, but for some reason architecturally implemented) that one image can be associated with several messages. This seems to be an architectural mistake with no real value for the app. So we decided to refactor this part and implement the schema where each image is associated with one message only (but of course one messge can have multiple images attached to it).
Implementing this new approach involves changing the database schema and the message workflow. In partiular it is important that when the message is deleted - the associated images are deleted too (no orphans). Another case is when the message is sent and received error response (for various reasonse) - we then have an option to delete it (again the images shall be deleted too) or resend it. The edit-resend ('e' key in the view mode) should work as follows: when the error-containing message is active and user press 'e' key the text of the message is copied to the input box in the input zone (ie becomes the draft of the new message) and the images attached to the error-containing message (if any) are attached to the new draft message (and later sent with it to the LLM in the regular routine). We need to carefully treat this and make sure again the images are neither lost, no orphaned. The next case is when the draft message with the attached images is abandoned (for example via reload of the app page or closing the app tab in the browser) - we haven't figured out what exactly should happen. Ideal scenario is that the draft message is preserved and restored on reopening - but when we tried to implement it we faced a 're-rendering' problem, ie the input zone got re-rendered and users observe flickering effect. 
3. Constraints and priorities. The absolute priority is performance, transparency and simplicity of the code. Focus on performance means, we should not use any symbol typing listeners, for example, or should not have any excessive DOM updates. The general principle is one DOM update per operations (what is implemented in renderMessages() function is an example how we should approach this). We should try to make interaction with user turn-like (e.g. the code ie executed when the user presses Enter, not while he drafts the message or modifies the settings of the app). Another major constraint is that we're at the final stage of the app development (pre-release) and most of the testing is done. So we need to make only surgical, isolated changes with prior extended analysis and elimination of possible side effects. The top priority is not to change the correct behaviour of the app.
